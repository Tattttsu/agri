<div class="container">
  <div class="row">
    <div class="col-md-6">
      <div class="image-container">
        <% if @farm.image.present? %>
          <%= image_tag @farm.image.url, class: "post-profile-icon" %>
        <% else %>
          <%= image_tag "野菜", class: "post-profile-icon" %>
        <% end %>
      </div>
      <% if @farm.user == current_user %>
        <%= link_to '編集', edit_farm_path(@farm), method: :get, class: "btn btn-success" %>
        <%= link_to '削除', farm_path(@farm), method: :delete, class: "btn btn-danger" %>
      <% end %>
    </div>

    <div class="col-md-6 ">
      <h2><%= @farm.name%></h2>
      <div class="user-box d-flex">
        <div class="user-icon">
          <%= link_to user_path(@farm.user) do %>
            <% if @farm.user.icon.present? %>
              <%= image_tag @farm.user.icon.url %>
            <% else %>
              <%= image_tag "icon" %>
            <% end %>
          <% end %>
        </div>
        <div class="user-name">
          <%= @farm.user.name %>
        </div>
      </div>
      <% if current_user.already_liked?(@farm) %>
        <%= link_to farm_likes_path(@farm), method: :delete do %>
          <i class="far fa-heart"></i>
          お気に入りを外す
        <% end %>
      <% else %>
        <%= link_to farm_likes_path(@farm), method: :post do %>
          <i class="far fa-heart"></i>
          お気に入りに追加
        <% end %>
      <% end %>
      <div class="mt-5">
        <h3>扱っている野菜</h3>
        <% @farm.vege_tags.each do |tag| %>
          <ul>
            <li><%= tag.name %></li>
          </ul>
        <% end %>
      </div>
      <div>
        <h3>特徴</h3>
        <%= safe_join(@farm.feature.split("\n"),tag(:br)) %>
      </div>
      <hr>
      <div class="form-block mt-5">
        <%= form_with(model: [@farm, @comment], method: :post) do |f| %>
          <%= f.text_area :content, class: "form-control border-1", placeholder: "コメント...", rows: "1" %>
          <% f.hidden_field :farm_id, value: @farm.id %>
          <%= f.submit 'コメントする' %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="comment-container">
    <% @comments.reverse.each do |comment| %>
      <hr>
        <div class="comment-row d-flex">
          <div class="user-icon">
            <%= link_to user_path(comment.user) do %>
              <% if comment.user.icon.present? %>
                <%= image_tag comment.user.icon.url %>
              <% else %>
                <%= image_tag "icon" %>
              <% end %>
            <% end %>
          </div>
          <div class="comment w-100 d-flex justify-content-between">
            <div>
              <%= comment.content %>
            </div>
            <div>
              <% if comment.user_id == current_user.id %>
                <%= link_to "編集", edit_farm_comment_path(@farm, comment), method: :get %>
                <%= link_to "削除", farm_comment_path(@farm, comment), method: :delete %>
              <% elsif @farm.user_id == current_user.id %>
                <%= link_to "削除", farm_comment_path(@farm, comment), method: :delete %>
              <% end %>
            </div>
          </div>
        </div>
    <% end %>
    <hr>
  </div>
</div>
